app-id: com.darhon.syncbackup
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: syncbackup
build-options:
    strip: true
finish-args:
  - --socket=x11
  - --socket=wayland
  - --share=ipc
  - --device=dri
  - --share=network
  - --filesystem=host
modules:
  - name: rsync
    buildsystem: autotools
    config-opts:
      - --disable-zstd
      - --disable-xxhash
    sources:
      - type: archive
        path: rsync_3.2.3.orig.tar.gz #https://packages.ubuntu.com/source/impish/rsync
    cleanup:
      - /share/man

  - name: ksshaskpass
    buildsystem: cmake
    sources:
      - type: archive
        path: ksshaskpass_5.22.5.orig.tar.xz #https://packages.ubuntu.com/source/impish/ksshaskpass
    cleanup:
      - /share/man

  - name: syncbackup
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        path: syncbackup_2.0.tar.xz
      
#  - name: syncbackup_sh
#    buildsystem: simple
#    build-commands:
#      - install -D syncbackup.sh $FLATPAK_DEST/bin/syncbackup.sh
#    sources:
#      - type: script
#        dest-filename: syncbackup.sh
#        commands: 
#          - export SSH_ASKPASS=$FLATPAK_DEST/bin/ksshaskpass
#          - $FLATPAK_DEST/bin/syncbackup

